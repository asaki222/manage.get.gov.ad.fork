{% extends "domain_base.html" %}
{% load static field_helpers%}

{% block title %}DNS name servers | {{ domain.name }} | {% endblock %}

{% block domain_content %}

  {# this is right after the messages block in the parent template #}
  {% for form in formset %}
    {% include "includes/form_errors.html" with form=form %}
  {% endfor %}
  
  {% block breadcrumb %}
  {% if portfolio %}
  <!-- Navigation breadcrumbs -->
  <nav class="usa-breadcrumb padding-top-0" aria-label="Domain breadcrumb">
    <ol class="usa-breadcrumb__list">
      <li class="usa-breadcrumb__list-item">
        <a href="{% url 'domains' %}" class="usa-breadcrumb__link"><span>Domains</span></a>
      </li>
      <li class="usa-breadcrumb__list-item">
        <a href="{% url 'domain' pk=domain.id %}" class="usa-breadcrumb__link"><span>{{ domain.name }}</span></a>
      </li>
      <li class="usa-breadcrumb__list-item">
        <a href="{% url 'domain-dns' pk=domain.id %}" class="usa-breadcrumb__link"><span>DNS</span></a>
      </li>
      <li class="usa-breadcrumb__list-item usa-current" aria-current="page">
        <span>DNS name servers</span>
      </li>
    </ol>
  </nav>
  {% endif %}
  {% endblock breadcrumb %}

  <div>
    <h1>Name Servers</h1>
    
    <button type="button" class="usa-button" id="nameserver-add-form">
      Add name servers
    </button>
  </div>
  <p>Before your domain can be used weâ€™ll need information about your domain name servers. Name server records indicate which DNS server is authoritative for your domain.</p>

  <p>Add a name server record by clicking "Add name servers". You must add at least two name servers (13 max).</p>

  {% include "includes/required_fields.html" %}
  <!-- if initial_data is none -->

  {% if formset.initial and formset.forms.0.initial %}
  <form class="usa-form usa-form--extra-large nameservers-form" method="post" novalidate id="form-container">
    {% csrf_token %}
    {{ formset.management_form }}



    <table class="usa-table usa-table--borderless usa-table--stacked dotgov-table dotgov-table--stacked">
      <caption class="sr-only">Your registered domains</caption>
      <thead>
        <tr>
          <th scope="col" role="columnheader">Name Servers </th>
          <th scope="col" role="columnheader">Action</th>
        </tr>
      </thead>
      <tbody>

    {% for form in formset %}
      {% if not forloop.last %}
        <tr>
          <td>Name of server</td>
          <td>action</td>
        </tr>
      {% endif %}
    {% endfor %}
            <!-- AJAX will populate this tbody -->
          </tbody>
        </table>
        <h1>hidden table:</h1>
    {% for form in formset %}
      {% if forloop.last %}
        <h2> got to this row</h2>
      {% endif %}
    {% endfor %}
    <!--
    if no data in formset: 
      build 2 blank forms
    --> 

    <!--
    else if data in formset: 
      build 1 blank form using the last form in the formset

      build a table of records using for form in formset-1

      

            <table .......>
              <thead>....</thead>
              <tbody>  
                {% for form in formset %}
                  <tr class="repeatable-form">
                    <td>
                      {% with sublabel_text="Example: ns"|concat:forloop.counter|concat:".example.com" %}
                        {% if forloop.counter <= 2 %}
                          {# span_for_text will wrap the copy in s <span>, which we'll use in the JS for this component #}
                          {% with attr_required=True add_group_class="usa-form-group--unstyled-error" span_for_text=True %}
                            {% input_with_errors form.server %}
                          {% endwith %}
                        {% else %}
                          {% with span_for_text=True %}
                            {% input_with_errors form.server %}
                            {% endwith %}
                        {% endif %}
                      {% endwith %}
                    </td>
                    <td>
                      {% with label_text=form.ip.label sublabel_text="Example: 86.124.49.54 or 2001:db8::1234:5678" add_group_class="usa-form-group--unstyled-error" add_aria_label="Name server "|concat:forloop.counter|concat:" "|concat:form.ip.label %}
                        {% input_with_errors form.ip %}
                      {% endwith %}
                    </td>
                    <td>
                      <button type="button" class="usa-button usa-button--unstyled usa-button--with-icon delete-record margin-bottom-075 text-secondary line-height-sans-5">
                        <svg class="usa-icon" aria-hidden="true" focusable="false" role="img" width="24" height="24">
                          <use xlink:href="{%static 'img/sprite.svg'%}#delete"></use>
                        </svg>Delete
                        <span class="sr-only">Name server {{forloop.counter}}</span>
                      </button>
                    </div>
                  </td>
                  </tr>
                  {% endfor %}
                </tboby>
              </table>        

    --> 

    <!-- {% for form in formset %}
    <div class="repeatable-form">
      <div class="grid-row grid-gap-2 flex-end">
        <div class="tablet:grid-col-5">
          {{ form.domain }}
          {% with sublabel_text="Example: ns"|concat:forloop.counter|concat:".example.com" %}
            {% if forloop.counter <= 2 %}
              {# span_for_text will wrap the copy in s <span>, which we'll use in the JS for this component #}
              {% with attr_required=True add_group_class="usa-form-group--unstyled-error" span_for_text=True %}
                {% input_with_errors form.server %}
              {% endwith %}
            {% else %}
              {% with span_for_text=True %}
                {% input_with_errors form.server %}
                {% endwith %}
            {% endif %}
          {% endwith %}
        </div>
        <div class="tablet:grid-col-5">
          {% with label_text=form.ip.label sublabel_text="Example: 86.124.49.54 or 2001:db8::1234:5678" add_group_class="usa-form-group--unstyled-error" add_aria_label="Name server "|concat:forloop.counter|concat:" "|concat:form.ip.label %}
            {% input_with_errors form.ip %}
          {% endwith %}
        </div>
        <div class="tablet:grid-col-2">
          <button type="button" class="usa-button usa-button--unstyled usa-button--with-icon delete-record margin-bottom-075 text-secondary line-height-sans-5">
            <svg class="usa-icon" aria-hidden="true" focusable="false" role="img" width="24" height="24">
              <use xlink:href="{%static 'img/sprite.svg'%}#delete"></use>
            </svg>Delete
            <span class="sr-only">Name server {{forloop.counter}}</span>
          </button>
        </div>
      </div>
    </div>
    {% endfor %} -->

    {% comment %} Work around USWDS' button margins to add some spacing between the submit and the 'add more'
    This solution still works when we remove the 'add more' at 13 forms {% endcomment %}
    <div class="margin-top-2">
      <button
            type="submit"
            class="usa-button"
        >Save
      </button>

      <button
            type="submit"
            class="usa-button usa-button--outline"
            name="btn-cancel-click"
            aria-label="Reset the data in the name server form to the registry state (undo changes)"
        >Cancel
      </button>
    </div>
  </form>
  {% else %}

  <h1>No initial data</h1>
  <form class="usa-form usa-form--extra-large nameservers-form" method="post" novalidate id="form-container">
    {% csrf_token %}
    {{ formset.management_form }}
    {% for form in formset %}
    <div class="repeatable-form">
      <div class="grid-row grid-gap-2 flex-end">
        <div class="tablet:grid-col-5">
          {{ form.domain }}
          {% with sublabel_text="Example: ns"|concat:forloop.counter|concat:".example.com" %}
            {% if forloop.counter <= 2 %}
              {# span_for_text will wrap the copy in s <span>, which we'll use in the JS for this component #}
              {% with attr_required=True add_group_class="usa-form-group--unstyled-error" span_for_text=True %}
                {% input_with_errors form.server %}
              {% endwith %}
            {% else %}
              {% with span_for_text=True %}
                {% input_with_errors form.server %}
                {% endwith %}
            {% endif %}
          {% endwith %}
        </div>
        <div class="tablet:grid-col-5">
          {% with label_text=form.ip.label sublabel_text="Example: 86.124.49.54 or 2001:db8::1234:5678" add_group_class="usa-form-group--unstyled-error" add_aria_label="Name server "|concat:forloop.counter|concat:" "|concat:form.ip.label %}
            {% input_with_errors form.ip %}
          {% endwith %}
        </div>
        <div class="tablet:grid-col-2">
          <button type="button" class="usa-button usa-button--unstyled usa-button--with-icon delete-record margin-bottom-075 text-secondary line-height-sans-5">
            <svg class="usa-icon" aria-hidden="true" focusable="false" role="img" width="24" height="24">
              <use xlink:href="{%static 'img/sprite.svg'%}#delete"></use>
            </svg>Delete
            <span class="sr-only">Name server {{forloop.counter}}</span>
          </button>
        </div>
      </div>
    </div>
    {% endfor %}
    {% comment %} Work around USWDS' button margins to add some spacing between the submit and the 'add more'
    This solution still works when we remove the 'add more' at 13 forms {% endcomment %}
    <div class="margin-top-2">
      <button
            type="submit"
            class="usa-button"
        >Save
      </button>

      <button
            type="submit"
            class="usa-button usa-button--outline"
            name="btn-cancel-click"
            aria-label="Reset the data in the name server form to the registry state (undo changes)"
        >Cancel
      </button>
    </div>
  </form>
  {% endif %}
{% endblock %}  {# domain_content #}
